<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Interactive Love Letter Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Kalam:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-pink: #ff6b9d;
            --secondary-purple: #c44569;
            --accent-gold: #ffd93d;
            --bg-dark: #1a1a2e;
            --bg-darker: #0f0f1e;
            --paper-white: #fff8f0;
            --text-dark: #2d3436;
            --envelope-cream: #fef5e7;
            --envelope-dark: #f8e6d0;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }

        /* Animated Background Stars */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        /* Floating Hearts Background */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            overflow: hidden;
        }

        .heart-particle {
            position: absolute;
            font-size: 20px;
            opacity: 0;
            animation: float-up 8s infinite;
        }

        @keyframes float-up {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Main Container */
        #app {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 2000px;
            position: relative;
            z-index: 10;
        }

        /* 3D Scene Container */
        #scene-container {
            transform-style: preserve-3d;
            transform-origin: center center;
            transition: transform 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        #scene-container.lifting {
            transform: scale(1.1) translateY(-30px);
        }

        #scene-container.zoomed {
            transform: scale(1.3) translateY(-50px) rotateX(2deg);
        }

        /* Hand Animation Container */
        .hand-container {
            position: fixed;
            bottom: -200px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 150px;
            z-index: 150;
            pointer-events: none;
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
        }

        .hand-container.picking {
            bottom: 40%;
            transform: translateX(-50%) scale(0.9) rotateZ(-5deg);
        }

        .hand-container.lifting {
            bottom: 70%;
            transform: translateX(-50%) scale(0.7) rotateZ(-12deg);
        }

        /* 3D Envelope Container */
        .envelope-wrapper {
            position: relative;
            width: 450px;
            height: 300px;
            transform-style: preserve-3d;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .envelope-wrapper:hover:not(.picked) {
            transform: translateY(-15px) rotateX(5deg);
        }

        .envelope-wrapper.picked {
            cursor: default;
            animation: envelope-lift 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes envelope-lift {
            0% { 
                transform: translateY(0) rotateZ(0deg); 
            }
            60% { 
                transform: translateY(-80px) rotateZ(-8deg); 
            }
            100% { 
                transform: translateY(-50px) rotateZ(-5deg); 
            }
        }

        /* Realistic 3D Envelope */
        .envelope-3d {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        /* Back of envelope */
        .envelope-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--envelope-cream) 0%, var(--envelope-dark) 100%);
            border-radius: 8px;
            box-shadow: 
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                0 20px 60px rgba(0, 0, 0, 0.4);
            transform: translateZ(-5px);
        }

        /* Envelope sides for depth */
        .envelope-left {
            position: absolute;
            width: 10px;
            height: 100%;
            background: linear-gradient(to right, #d4b896, var(--envelope-dark));
            transform-origin: left;
            transform: translateX(-5px) rotateY(90deg);
            left: 0;
        }

        .envelope-right {
            position: absolute;
            width: 10px;
            height: 100%;
            background: linear-gradient(to left, #d4b896, var(--envelope-dark));
            transform-origin: right;
            transform: translateX(5px) rotateY(-90deg);
            right: 0;
        }

        .envelope-bottom {
            position: absolute;
            width: 100%;
            height: 10px;
            background: linear-gradient(to bottom, var(--envelope-dark), #d4b896);
            transform-origin: bottom;
            transform: translateY(5px) rotateX(-90deg);
            bottom: 0;
        }

        /* Front flap (bottom) */
        .envelope-front-flap {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--envelope-cream) 0%, #f0dfc8 100%);
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
            border-radius: 8px;
            transform: translateZ(1px);
            box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Decorative lines on envelope */
        .envelope-lines {
            position: absolute;
            width: 60%;
            left: 20%;
            top: 50%;
            transform: translateZ(2px);
        }

        .envelope-line {
            height: 2px;
            background: rgba(0, 0, 0, 0.15);
            margin: 12px 0;
            border-radius: 1px;
        }

        .envelope-line:nth-child(2) {
            width: 80%;
        }

        .envelope-line:nth-child(3) {
            width: 60%;
        }

        /* Top triangular flap */
        .envelope-top-flap {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, var(--envelope-cream) 0%, var(--envelope-dark) 100%);
            clip-path: polygon(0 0, 100% 0, 50% 55%);
            transform-origin: top;
            transition: transform 0.9s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform: translateZ(3px);
            border-radius: 8px 8px 0 0;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 3px rgba(255, 255, 255, 0.3);
        }

        .envelope-top-flap::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3) 25%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.3) 75%, 
                transparent
            );
        }

        .envelope-top-flap::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(to bottom, 
                rgba(0, 0, 0, 0.15), 
                transparent
            );
            opacity: 0;
            transition: opacity 0.9s ease;
        }

        .envelope-wrapper.opened .envelope-top-flap {
            transform: translateZ(3px) rotateX(-180deg);
        }

        .envelope-wrapper.opened .envelope-top-flap::after {
            opacity: 1;
        }

        /* Wax Seal */
        .wax-seal {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(8px);
            width: 90px;
            height: 90px;
            background: radial-gradient(circle at 30% 30%, #ff8fab, var(--primary-pink), var(--secondary-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            box-shadow: 
                0 8px 25px rgba(255, 107, 157, 0.7),
                inset -2px -2px 5px rgba(0, 0, 0, 0.2),
                inset 2px 2px 5px rgba(255, 255, 255, 0.3);
            transition: all 0.6s cubic-bezier(0.6, 0.04, 0.98, 0.34);
            animation: pulse-glow 2.5s infinite;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .wax-seal::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, transparent 0%, rgba(0, 0, 0, 0.1) 100%);
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 
                    0 8px 25px rgba(255, 107, 157, 0.7),
                    inset -2px -2px 5px rgba(0, 0, 0, 0.2),
                    inset 2px 2px 5px rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 
                    0 8px 40px rgba(255, 107, 157, 1),
                    0 0 60px rgba(255, 107, 157, 0.5),
                    inset -2px -2px 5px rgba(0, 0, 0, 0.2),
                    inset 2px 2px 5px rgba(255, 255, 255, 0.3);
            }
        }

        .envelope-wrapper.opened .wax-seal {
            opacity: 0;
            transform: translate(-50%, -50%) translateZ(8px) scale(0.3) rotate(90deg) translateY(50px);
        }

        /* Decorative stamp */
        .stamp {
            position: absolute;
            top: 20px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ffd93d, #f6b93b);
            border: 3px dashed rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transform: translateZ(2px) rotate(12deg);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Sparkles around envelope */
        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--accent-gold);
            border-radius: 50%;
            animation: sparkle-dance 2s infinite;
            box-shadow: 0 0 15px var(--accent-gold);
        }

        @keyframes sparkle-dance {
            0%, 100% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-20px) scale(1.5); opacity: 0.5; }
        }

        /* Letter Container */
        .letter-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0) rotateY(180deg);
            width: 90%;
            max-width: 900px;
            height: 85vh;
            max-height: 700px;
            opacity: 0;
            transition: all 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100;
            pointer-events: none;
        }

        .letter-container.show {
            transform: translate(-50%, -50%) scale(1) rotateY(0deg);
            opacity: 1;
            pointer-events: all;
        }

        /* Letter Paper */
        .letter-paper {
            background: var(--paper-white);
            height: 100%;
            border-radius: 15px;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.5);
            padding: 2.5rem;
            overflow-y: auto;
            position: relative;
            background-image: 
                repeating-linear-gradient(
                    transparent,
                    transparent 35px,
                    rgba(102, 126, 234, 0.1) 35px,
                    rgba(102, 126, 234, 0.1) 36px
                );
            border-left: 4px solid var(--primary-pink);
            display: flex;
            flex-direction: row;
            gap: 2rem;
        }

        .letter-paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 48%, rgba(255, 255, 255, 0.3) 50%, transparent 52%);
            pointer-events: none;
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Letter Content Area */
        .letter-content {
            flex: 1;
            min-width: 0;
            position: relative;
            z-index: 1;
        }

        /* Polaroid Container */
        .polaroid-container {
            flex-shrink: 0;
            width: 250px;
            align-self: flex-start;
            position: sticky;
            top: 1rem;
            z-index: 5;
        }

        /* Typography */
        .letter-title {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: var(--secondary-purple);
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: fade-in-down 1s ease-out;
        }

        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .letter-text {
            font-family: 'Kalam', cursive;
            font-size: 1.3rem;
            line-height: 2.2;
            color: var(--text-dark);
            white-space: pre-wrap;
            animation: fade-in 1.5s ease-out;
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Image Polaroid */
        .polaroid {
            background: white;
            padding: 15px;
            padding-bottom: 50px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            transform: rotate(3deg);
            transition: all 0.4s ease;
            width: 100%;
            cursor: pointer;
            margin-bottom: 1.5rem;
        }

        .polaroid:hover {
            transform: rotate(0deg) scale(1.05);
            z-index: 20;
        }

        .polaroid.flipped {
            transform: rotateY(180deg) scale(1.05);
        }

        .polaroid-front, .polaroid-back {
            transition: opacity 0.3s;
        }

        .polaroid.flipped .polaroid-front {
            opacity: 0;
        }

        .polaroid-back {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Kalam', cursive;
            font-size: 1.1rem;
            text-align: center;
            color: var(--text-dark);
            padding: 20px;
            opacity: 0;
            transform: rotateY(180deg);
        }

        .polaroid.flipped .polaroid-back {
            opacity: 1;
        }

        .polaroid img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .polaroid-caption {
            font-family: 'Kalam', cursive;
            text-align: center;
            margin-top: 10px;
            color: var(--text-dark);
            font-size: 1rem;
        }

        /* Page Decorations */
        .corner-heart {
            position: absolute;
            font-size: 2rem;
            opacity: 0.3;
            animation: pulse 3s infinite;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 2;
        }

        .corner-heart:hover {
            opacity: 1;
            transform: scale(1.5) rotate(20deg);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Heart Burst Effect */
        .heart-burst {
            position: fixed;
            font-size: 2rem;
            pointer-events: none;
            z-index: 1000;
            animation: burst-out 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes burst-out {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        /* Navigation Controls */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 200;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: opacity 0.5s ease;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            font-family: 'Kalam', cursive;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-pink), var(--secondary-purple));
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-close {
            background: linear-gradient(135deg, #ee0979, #ff6a00);
            color: white;
        }

        .page-indicator {
            font-family: 'Kalam', cursive;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
            padding: 0 15px;
        }

        /* Music Toggle */
        .music-toggle {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-pink), var(--secondary-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.5);
            transition: all 0.3s ease;
            z-index: 300;
            font-size: 1.5rem;
        }

        .music-toggle:hover {
            transform: scale(1.1) rotate(10deg);
        }

        .music-toggle.playing {
            animation: music-pulse 1s infinite;
        }

        @keyframes music-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Instructions hint */
        .instruction-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-family: 'Kalam', cursive;
            font-size: 1.3rem;
            text-align: center;
            z-index: 250;
            pointer-events: none;
            animation: fade-pulse 2s infinite;
            backdrop-filter: blur(5px);
            transition: opacity 0.5s ease;
        }

        @keyframes fade-pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .instruction-hint.hidden {
            opacity: 0;
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 500;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modal-pop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes modal-pop {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal-text {
            font-family: 'Kalam', cursive;
            font-size: 1.5rem;
            color: var(--text-dark);
            margin-bottom: 30px;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-heart {
            font-size: 5rem;
            animation: heartbeat 1s infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.2); }
            50% { transform: scale(1); }
        }

        .loading-text {
            font-family: 'Great Vibes', cursive;
            font-size: 2rem;
            color: white;
            margin-top: 20px;
        }

        /* Scrollbar */
        .letter-paper::-webkit-scrollbar {
            width: 8px;
        }

        .letter-paper::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .letter-paper::-webkit-scrollbar-thumb {
            background: var(--primary-pink);
            border-radius: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .envelope-wrapper {
                width: 320px;
                height: 220px;
            }
            
            .hand-container {
                font-size: 100px;
            }
            
            .letter-paper {
                padding: 2rem;
                flex-direction: column;
            }

            .letter-content {
                order: 1;
            }

            .polaroid-container {
                order: 2;
                width: 100%;
                position: relative;
                top: auto;
                margin-top: 1.5rem;
            }

            .polaroid {
                max-width: 280px;
                margin: 0 auto 1.5rem;
            }
            
            .letter-title {
                font-size: 2rem;
            }
            
            .letter-text {
                font-size: 1.1rem;
            }
            
            .controls {
                flex-wrap: wrap;
                padding: 10px 20px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-heart">üíñ</div>
        <div class="loading-text">Preparing your love letter...</div>
    </div>

    <!-- Background Effects -->
    <div class="stars" id="stars"></div>
    <div class="floating-hearts" id="floatingHearts"></div>

    <!-- Instruction Hint -->
    <div class="instruction-hint" id="instructionHint">
        üëÜ Click the envelope to open your love letter
    </div>

    <!-- Music Toggle -->
    <div class="music-toggle" id="musicToggle" title="Toggle Music">
        üéµ
    </div>

    <!-- Animated Hand -->
    <div class="hand-container" id="handContainer">
        ‚úã
    </div>

    <!-- Main App -->
    <div id="app">
        <div id="sceneContainer">
            <!-- 3D Envelope -->
            <div class="envelope-wrapper" id="envelopeWrapper">
                <div class="envelope-3d">
                    <!-- Envelope structure -->
                    <div class="envelope-back"></div>
                    <div class="envelope-left"></div>
                    <div class="envelope-right"></div>
                    <div class="envelope-bottom"></div>
                    
                    <div class="envelope-front-flap">
                        <div class="envelope-lines">
                            <div class="envelope-line"></div>
                            <div class="envelope-line"></div>
                            <div class="envelope-line"></div>
                        </div>
                    </div>
                    
                    <div class="stamp">üíå</div>
                    <div class="envelope-top-flap"></div>
                    <div class="wax-seal">üíï</div>
                    
                    <!-- Sparkles -->
                    <div class="sparkle" style="top: 15%; left: 8%; animation-delay: 0s;"></div>
                    <div class="sparkle" style="top: 25%; right: 12%; animation-delay: 0.5s;"></div>
                    <div class="sparkle" style="bottom: 20%; left: 15%; animation-delay: 1s;"></div>
                    <div class="sparkle" style="bottom: 30%; right: 8%; animation-delay: 1.5s;"></div>
                    <div class="sparkle" style="top: 50%; left: 5%; animation-delay: 0.7s;"></div>
                    <div class="sparkle" style="top: 60%; right: 5%; animation-delay: 1.3s;"></div>
                </div>
            </div>

            <!-- Letter -->
            <div class="letter-container" id="letterContainer">
                <div class="letter-paper" id="letterPaper">
                    <!-- Corner Hearts -->
                    <div class="corner-heart" style="top: 10px; left: 10px;" title="Click me!">üíñ</div>
                    <div class="corner-heart" style="top: 10px; right: 10px; animation-delay: 1s;" title="Click me!">üíï</div>
                    <div class="corner-heart" style="bottom: 10px; left: 10px; animation-delay: 2s;" title="Click me!">üíó</div>
                    <div class="corner-heart" style="bottom: 10px; right: 10px; animation-delay: 1.5s;" title="Click me!">üíù</div>
                    
                    <div class="letter-content">
                        <h1 class="letter-title" id="letterTitle"></h1>
                        <div class="letter-text" id="letterText"></div>
                    </div>
                    
                    <div class="polaroid-container">
                        <div class="polaroid" id="polaroid" title="Click to flip!">
                            <div class="polaroid-front">
                                <img id="polaroidImg" src="" alt="Memory">
                                <div class="polaroid-caption" id="polaroidCaption"></div>
                            </div>
                            <div class="polaroid-back" id="polaroidBack">
                                A cherished memory frozen in time... üíï
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls" id="controls" style="opacity: 0; pointer-events: none;">
        <button class="btn btn-secondary" id="prevBtn" disabled>
            <span>‚Üê</span> Previous
        </button>
        <span class="page-indicator" id="pageIndicator">Page 1 / 3</span>
        <button class="btn btn-primary" id="nextBtn">
            Next <span>‚Üí</span>
        </button>
        <button class="btn btn-close" id="closeBtn">
            <span>‚úï</span> Close
        </button>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon">üéâ</div>
            <div class="modal-text" id="modalText"></div>
            <button class="btn btn-primary" onclick="closeModal()">Got it!</button>
        </div>
    </div>

    <script>
        // Animation timing constants (optimized for smoother flow)
        const TIMING = {
            HAND_REACH: 800,
            HAND_LIFT: 500,
            ENVELOPE_OPEN: 600,
            CAMERA_ZOOM: 700,
            LETTER_REVEAL: 500,
            CONTROLS_FADE: 300
        };

        // Animation state machine
        const AnimationState = {
            IDLE: 'idle',
            HAND_REACHING: 'reaching',
            LIFTING: 'lifting',
            OPENING: 'opening',
            ZOOMING: 'zooming',
            REVEALING: 'revealing',
            COMPLETE: 'complete'
        };

        // Letter Content
        const pages = [
            {
                title: "To My Dearest Love",
                text: `Happy new year po, my love! I hope you're doing well. While the years pass by and waver, my feelings will never.

As we enter the 3rd year of our relationship, we realize na sobrang dami na talagang nagbago 'no? Hindi na tayo katulad ng dati compared to the first months of getting to know each other.

Hindi na rin tayo yung tulad ng dati na halos araw-araw linggo-linggong nagsusulat ng essays para mag-open up at magbato ng nilalaman ng isip sa isa't isa. I'm so happy we went the extra mile to do that for each other. It was so effective, as each one we write brings us closer to each other.

Nandiyan pa rin yung kilig, pero wala na yung spark, if you know what i mean. It's like we're more bestfriends and buddies than lovers now, but to be honest, i think i like it this way too! =).

But despite that, I'm still thankful to you for your loyalty and genuine appreciation for what we have and the things our relationship offers.

This letter is just the beginning of expressing what you mean to me...`,
                image: "source images/firstdate.jpg",
                caption: "The day we met ‚ú®",
                backMessage: "This was the moment everything changed. I knew right then you were special. üíñ"
            },
            {
                title: "One Picture, A Thousand Memories",
                text: `Do you remember our first date? The way you laughed at my terrible jokes, how the world seemed to fade away when we walked around, and went to different places. Every moment of that with you is a treasure I hold close to my heart.

I love the way you see the world, with such kindness and gentleness. You inspire me to be a better person, both for myself, for you and for us. With you, I start to live my days again and look towards a better more meaningful future. Your compassion, your ingenuity, your strength, your beautiful soul - everything about you amazes me.

Through every challenge, every victory, every ordinary day - I wish to be by your side. You are my best friend, my duo, my confidant, and everything else in between, and as long as we're together, we can face anything life brings our way.

Thank you for being exactly who you are...`,
                image: "source images/holdinghands.jpg",
                caption: "The first time I held your hand üíï",
                backMessage: "Every time I see this, I remember how lucky I am to have you in my life. üåü"
            },
            {
                title: "Forever & Always",
                text: `As I craft this letter, my heart overflows with love for you. This isn't just a letter - it's a promise. A promise to love you unconditionally, to support your dreams, to prioritize you over all else, to hold your hand through every season of life.

I promise to be with you when you're feeling down, to celebrate your victories, to comfort you in times of sorrow. I promise to choose you, no one else, every single day, for the rest of my days.

I know you know this yourself, this should go without saying, but my love for you knows no bounds, no distances, transcends all obstacles, and grows stronger with each passing moment.
I've already traveled hundreds of miles to be with you, and I would do it a thousand times over just to see your smile, to hear your laughter, to feel your warmth.

Thank you for loving me, for choosing me, for giving me a chance to get to know you on a deeper level. You are my greatest adventure, my safest place, my home.

With all my love, now and forever,
Ian üíñ`,
                image: "source images/kiss.png",
                caption: "Forever together üíë",
                backMessage: "This is us. This is our future. This is everything I've ever dreamed of. Together, always. üíï"
            }
        ];

        // State
        let currentPage = 0;
        let musicPlaying = false;
        let envelopeOpened = false;
        let currentAnimState = AnimationState.IDLE;

        // Elements
        const envelopeWrapper = document.getElementById('envelopeWrapper');
        const handContainer = document.getElementById('handContainer');
        const sceneContainer = document.getElementById('sceneContainer');
        const letterContainer = document.getElementById('letterContainer');
        const letterTitle = document.getElementById('letterTitle');
        const letterText = document.getElementById('letterText');
        const polaroid = document.getElementById('polaroid');
        const polaroidImg = document.getElementById('polaroidImg');
        const polaroidCaption = document.getElementById('polaroidCaption');
        const polaroidBack = document.getElementById('polaroidBack');
        const controls = document.getElementById('controls');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const closeBtn = document.getElementById('closeBtn');
        const pageIndicator = document.getElementById('pageIndicator');
        const musicToggle = document.getElementById('musicToggle');
        const modal = document.getElementById('modal');
        const modalIcon = document.getElementById('modalIcon');
        const modalText = document.getElementById('modalText');
        const loadingScreen = document.getElementById('loadingScreen');
        const instructionHint = document.getElementById('instructionHint');

        // Initialize
        function init() {
            createStars();
            createFloatingHearts();
            renderPage();
            
            // Remove loading screen
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
            }, 2000);

            // Hide instruction after 5 seconds
            setTimeout(() => {
                instructionHint.classList.add('hidden');
            }, 5000);

            // Event Listeners
            envelopeWrapper.addEventListener('click', pickUpEnvelope);
            nextBtn.addEventListener('click', nextPage);
            prevBtn.addEventListener('click', prevPage);
            closeBtn.addEventListener('click', closeLetter);
            musicToggle.addEventListener('click', toggleMusic);
            polaroid.addEventListener('click', flipPolaroid);
            
            // Corner hearts interaction
            document.querySelectorAll('.corner-heart').forEach(heart => {
                heart.addEventListener('click', (e) => {
                    createHeartBurst(e.clientX, e.clientY);
                });
            });
        }

        // Create animated stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Create floating hearts
        function createFloatingHearts() {
            const heartsContainer = document.getElementById('floatingHearts');
            const hearts = ['üíñ', 'üíï', 'üíó', 'üíù', 'üíì', 'üíû'];
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart-particle';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 4 + 6) + 's';
                heart.style.fontSize = (Math.random() * 15 + 15) + 'px';
                heartsContainer.appendChild(heart);
                
                setTimeout(() => heart.remove(), 8000);
            }, 800);
        }

        // Create heart burst effect (optimized)
        function createHeartBurst(x, y) {
            const hearts = ['üíñ', 'üíï', 'üíó', 'üíù', 'üíì', 'üíû'];
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < 8; i++) {
                const heart = document.createElement('div');
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.className = 'heart-burst';
                
                const angle = (Math.PI * 2 * i) / 8;
                const distance = 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                heart.style.cssText = `
                    left: ${x}px;
                    top: ${y}px;
                    --tx: ${tx}px;
                    --ty: ${ty}px;
                `;
                
                fragment.appendChild(heart);
            }
            
            document.body.appendChild(fragment);
            
            setTimeout(() => {
                document.querySelectorAll('.heart-burst').forEach(h => h.remove());
            }, 1000);
        }

        // Pick up envelope with optimized animation timing
        function pickUpEnvelope() {
            if (envelopeOpened || currentAnimState !== AnimationState.IDLE) return;
            
            instructionHint.classList.add('hidden');
            envelopeWrapper.style.pointerEvents = 'none';
            currentAnimState = AnimationState.HAND_REACHING;
            
            // Phase 1: Hand reaches
            handContainer.classList.add('picking');
            
            setTimeout(() => {
                currentAnimState = AnimationState.LIFTING;
                envelopeWrapper.classList.add('picked');
                handContainer.classList.add('lifting');
                sceneContainer.classList.add('lifting');
                
                // Phase 2: Start opening (overlapped)
                setTimeout(() => {
                    currentAnimState = AnimationState.OPENING;
                    envelopeWrapper.classList.add('opened');
                    sceneContainer.classList.remove('lifting');
                    
                    // Phase 3: Zoom camera (overlapped)
                    setTimeout(() => {
                        currentAnimState = AnimationState.ZOOMING;
                        sceneContainer.classList.add('zoomed');
                        
                        // Phase 4: Reveal letter
                        setTimeout(() => {
                            currentAnimState = AnimationState.REVEALING;
                            letterContainer.classList.add('show');
                            envelopeWrapper.style.opacity = '0';
                            handContainer.style.opacity = '0';
                            
                            setTimeout(() => {
                                currentAnimState = AnimationState.COMPLETE;
                                controls.style.opacity = '1';
                                controls.style.pointerEvents = 'all';
                                envelopeOpened = true;
                            }, TIMING.CONTROLS_FADE);
                        }, TIMING.LETTER_REVEAL);
                    }, TIMING.ENVELOPE_OPEN - 300);
                }, TIMING.HAND_LIFT - 200);
            }, TIMING.HAND_REACH);
        }

        // Flip polaroid
        function flipPolaroid() {
            polaroid.classList.toggle('flipped');
        }

        // Render current page
        function renderPage() {
            const page = pages[currentPage];
            letterTitle.textContent = page.title;
            letterText.textContent = page.text;
            polaroidImg.src = page.image;
            polaroidCaption.textContent = page.caption;
            polaroidBack.textContent = page.backMessage;
            
            // Remove flipped state when changing pages
            polaroid.classList.remove('flipped');
            
            pageIndicator.textContent = `Page ${currentPage + 1} / ${pages.length}`;
            prevBtn.disabled = currentPage === 0;
            nextBtn.disabled = currentPage === pages.length - 1;
            
            if (currentPage === pages.length - 1) {
                nextBtn.innerHTML = 'Finished <span>üíï</span>';
            } else {
                nextBtn.innerHTML = 'Next <span>‚Üí</span>';
            }
        }

        // Close letter
        function closeLetter() {
            letterContainer.classList.remove('show');
            controls.style.opacity = '0';
            controls.style.pointerEvents = 'none';
            
            setTimeout(() => {
                envelopeWrapper.style.opacity = '1';
                handContainer.style.opacity = '1';
                
                setTimeout(() => {
                    sceneContainer.classList.remove('zoomed');
                    handContainer.classList.remove('lifting');
                    
                    setTimeout(() => {
                        envelopeWrapper.classList.remove('opened');
                        envelopeWrapper.classList.remove('picked');
                        handContainer.classList.remove('picking');
                        envelopeWrapper.style.pointerEvents = 'all';
                        envelopeOpened = false;
                        currentAnimState = AnimationState.IDLE;
                        currentPage = 0;
                        renderPage();
                    }, 1000);
                }, 500);
            }, 800);
        }

        // Navigation
        function nextPage() {
            if (currentPage < pages.length - 1) {
                currentPage++;
                renderPage();
            } else {
                modalIcon.textContent = 'üíñ';
                showModal("You've reached the end of this love letter. My feelings for you are endless, and this is just the beginning of our beautiful story together! Every page turn is a step deeper into my heart. üíï");
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                renderPage();
            }
        }

        // Music toggle
        function toggleMusic() {
            musicPlaying = !musicPlaying;
            musicToggle.classList.toggle('playing', musicPlaying);
            
            if (musicPlaying) {
                musicToggle.textContent = 'üéµ';
                modalIcon.textContent = 'üé∂';
                showModal("Imagine a beautiful romantic melody playing softly in the background... Close your eyes and feel the love! üé∂üíï");
            } else {
                musicToggle.textContent = 'üîá';
                modalIcon.textContent = 'ü§´';
                showModal("Music paused. But the love never stops! üíñ");
            }
        }

        // Modal functions
        function showModal(text) {
            modalText.textContent = text;
            modal.classList.add('show');
        }

        function closeModal() {
            modal.classList.remove('show');
        }

        // Start everything
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>